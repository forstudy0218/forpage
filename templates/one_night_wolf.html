<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ONE NIGHT</title>
    <!-- Try vue.js with i18n this time -->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <!-- MIT License -->
    <script src="https://unpkg.com/vue-i18n/dist/vue-i18n.js"></script>
    <!-- Bootstrap -->
    <!-- https://getbootstrap.com/docs/4.0/components/navbar/ -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    {% raw -%}
    <div id="app">
        <!-- for lang change -->
        <div class="lang-changer">
          <select v-model="$i18n.locale" @change="onLocaleChange()">
            <option v-for="(lang, i) in langs" :key="`Lang${i}`" :value="lang.value">{{ lang.name }}</option>
          </select>
        </div>
        <!-- front page -->
        <template v-if="presisted.stage === 0">
          <h1 class="game_title_text">{{ $t("frontPage.topic") }}</h1>
          <div class="obj_container">
            <h3 class="obj_title">{{ $t("frontPage.header") }}</h3>
            <p class="good_text" v-html='$t("frontPage.villagers")'></p>
            <p class="ww_text" v-html='$t("frontPage.werewolve")'></p>
            <h6 class="vote_text">{{ $t("frontPage.vote") }}</h6>
          </div>
          <div class="amount_container">
            <div class="amount_text">{{ $t("frontPage.amount") }}</div>
            <select v-model="players_amount" style="padding: 5%;">
              <option v-for="i in 5" :key="`${i}`" :value="i + 2">{{ i + 2 }}</option>
            </select>
            <button class="btn btn-primary amountBtn" @click="goToName">{{ $t("frontPage.startBtn") }}</button>
          </div>
          <div class="exit_area"><a class="btn btn-danger" href="/">{{ $t("frontPage.exitBtn") }}</a></div>
        </template>
        <!-- naming page -->
        <template v-if="presisted.stage === 1">
          <div class="container">
            <!-- list of roles -->
            <div class="row roles_banner">
              <span>{{ $t("naming.rolesAre") }}</span>
              <span v-for="(roleStr) in roles" :class="'naming_role_' + roleStr">{{ $t("roles." + roleStr) + ", " }}</span>
            </div>
            <!-- bootstrap table -->
            <div id="from_table" class="row justify-content-center">
              <div class="col-5 col-lg-3 player_form" v-for="(player, i) in presisted.players">
                <input v-model="playerNames[i]" :placeholder="$t('naming.placeholder')" class="name_input">
              </div>
            </div>
            <!-- start button -->
            <div id="start_area" class="row">
              <button class="btn btn-success startBtn" @click="gameStart">{{ $t("naming.startBtn") }}</button>
            </div>
          </div>
        </template>
        <!-- night page -->
        <template v-if="presisted.stage === 2 || presisted.stage === 3">
          <!-- wrap whole page -->
          <div class="page_container">
            <!-- wrap name button -->
            <div class="name_btn_container">
              <template v-for="player in presisted.players">
                <button :class="getCls(player.name)" @click="toggleInfo(player.name)" :disabled="toggleNameButton(player.name)">
                  {{ player.name }}
                </button>
              </template>
            </div>
            <!-- wrap console -->
            <div class="console_container">
              <!-- button clicked -->
              <template v-if="player_toggle">
                <!-- player confirmed -->
                <template v-if="is_checking">
                  <!-- player want to see -->
                  <template v-if="show_role && presisted.stage === 2">
                    <h1 :class=" user_role + '_header' ">{{ $t("console.YouAre") + $t("roles." + user_role) }}</h1>
                    <p class="ability_text">{{ $t("console.st_" + user_role) }}</p>
                    <p class="ability_text">{{ $t("console.nd_" + user_role) }}</p>
                    <select></select>
                    <p class="ability_text">{{ $t("console.rd_" + user_role) }}</p>
                    <button class="btn btn-warning" @click="useAbility(user_role)">{{ $t("frontPage.startBtn") }}</button>
                  </template>
                  <!-- ability result -->
                  <template v-else-if="night_result && presisted.stage === 2">
                    <p class="ability_text"></p>
                    <button class="btn btn-warning" @click="endPlayerConsole(user_name)">{{ $t("frontPage.startBtn") }}</button>
                  </template>
                  <!-- ask player to see -->
                  <template v-else-if="presisted.stage === 2">
                    <h1 class="user_header">{{ user_name }}</hi>
                    <button class="btn btn-danger simple_center" @click="roleShow">{{ $t("console.showMyRole") }}</button>
                  </template>
                </template>
                <!-- player yet confirm -->
                <template v-else>
                  <h1 class="user_header">{{ $t("console.askIfPlayer") + user_name + " ?"}}</h1>
                  <button class="btn btn-danger simple_center" @click="playerConfirmeSelf">{{ $t("console.IAm") + user_name }}</button>
                </template>
              </template>
              <!-- plain stage description -->
              <template v-else-if="!stage_end">
                <!-- night description -->
                <h1 v-if="presisted.stage === 2" class="stage_header" v-html='$t("console.night")'></h1>
                <h1 v-else class="stage_header" v-html='$t("console.day")'></h1>
                <p class="ask_player_text">{{ $t("console.askForPlayer") }}</p>
              </template>
              <!-- next stage alert -->
              <template v-else>
                <h1 class="stage_header">{{ $t("console.stageEnd") }}</h1>
                <button class="btn btn-success simple_center" @click="presisted.stage += 1">{{ $t("console.nextStage") }}</button>
              </template>
            </div>
          </div>
        </template>
        <!-- global error message -->
        <div v-if="toggle_error && presisted.stage !== 99" class="error_message">{{ $t("errorType."+ err_type) }}</div>
        <!-- pause area -->
        <template v-if="presisted.stage === 99">
          <div class="pausePage">
            <h1 class="pauseTitle">{{ $t("pauseControl.title") }}</h1>
            <button class="btn btn-danger removeBtn" @click="removeGame">{{ $t("pauseControl.removal") }}</button>
            <!-- debug mode button -->
            <button class="btn btn-dark debugBtn" @click="debugMode"></button>
          </div>
        </template>
        <!-- universal(sort of) button -->
        <template v-if="(presisted.stage !== 0)">
          <div class="bottomBtn">
            <button class="btn btn-warning" @click="togglePause">
              <!-- use v-show coz toggle might be offen -->
              <span v-show="presisted.stage !== 99">{{ $t("pauseControl.toPause") }}</span>
              <span v-show="presisted.stage === 99">{{ $t("pauseControl.returnGame") }}</span>
            </button>
          </div>
        </template>
    </div>
    <!-- style -->
    <link href="/static/onwcss.css" rel="stylesheet">
    <!-- javascript -->
    <script src="/static/one_night_ww.js"></script>
    {%- endraw %}
  </body>